{% extends "users/base_dashboard.html" %}

{% block title %}Create Course – EduSphere{% endblock %}

{% block header %}
  <header class="header">
    <div class="header-title">
      <h1>Create New Course</h1>
      <p>Enter the details below</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-secondary">
            <i class="fas fa-eye"></i> Preview
        </button>
        <button class="btn btn-primary">
            <i class="fas fa-save"></i> Save Draft
        </button>
    </div>
  </header>
{% endblock %}

{% block content %}
    <!-- Course Creation Form -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="course-creation">
            <!-- Main Form Section -->
            <div class="form-column">
                <!-- Course Basics Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-info-circle"></i> Course Basics
                    </h3>
                    
                    <div class="form-group">
                        {{ form.title.label_tag }}
                        {{ form.title }}
                        <p class="form-helper">Keep it concise yet descriptive (60 characters or less)</p>
                        {% if form.title.errors %}
                            <div class="error">{{ form.title.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        {{ form.subtitle.label_tag }}
                        {{ form.subtitle }}
                        <p class="form-helper">A brief summary of your course (120 characters or less)</p>
                        {% if form.subtitle.errors %}
                            <div class="error">{{ form.subtitle.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        {{ form.description.label_tag }}
                        {{ form.description }}
                        <p class="form-helper">This will appear on your course landing page</p>
                        {% if form.description.errors %}
                            <div class="error">{{ form.description.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        {{ form.category.label_tag }}
                        {{ form.category }}
                        {% if form.category.errors %}
                            <div class="error">{{ form.category.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Course Media Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-images"></i> Course Media
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label required">Course Thumbnail</label>
                        {{ form.thumbnail }}
                        <p class="form-helper">Recommended size: 1280×720 pixels (16:9 aspect ratio)</p>
                        {% if form.thumbnail.errors %}
                            <div class="error">{{ form.thumbnail.errors }}</div>
                        {% endif %}
                        <div class="preview-container" id="thumbnail-preview">
                            <img src="" alt="Course Thumbnail Preview" class="preview-image">
                            <button class="remove-image">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Promotional Video (Optional)</label>
                        {{ form.promo_video }}
                        <p class="form-helper">MP4 format, max 2 minutes, 1080p recommended</p>
                        {% if form.promo_video.errors %}
                            <div class="error">{{ form.promo_video.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Curriculum Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-list-ol"></i> Curriculum
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label required">Course Structure</label>
                        <div id="curriculum-builder">
                            {{ section_formset.management_form }}
                            {% for form in section_formset %}
                                <div class="section-form">
                                    {{ form.id }}
                                    <div class="form-group">
                                        {{ form.order.label_tag }}
                                        {{ form.order }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.title.label_tag }}
                                        {{ form.title }}
                                    </div>
                                    {% if form.DELETE %}
                                        <div class="form-group">
                                            {{ form.DELETE.label_tag }}
                                            {{ form.DELETE }}
                                        </div>
                                    {% endif %}
                                    
                                    <!-- Lectures for this section -->
                                    {{ form.lecture_formset.management_form }}
                                    {% for lecture_form in form.lecture_formset %}
                                        <div class="lecture-form">
                                            {{ lecture_form.id }}
                                            <div class="form-group">
                                                {{ lecture_form.order.label_tag }}
                                                {{ lecture_form.order }}
                                            </div>
                                            <div class="form-group">
                                                {{ lecture_form.title.label_tag }}
                                                {{ lecture_form.title }}
                                            </div>
                                            <div class="form-group">
                                                {{ lecture_form.content.label_tag }}
                                                {{ lecture_form.content }}
                                            </div>
                                            {% if lecture_form.DELETE %}
                                                <div class="form-group">
                                                    {{ lecture_form.DELETE.label_tag }}
                                                    {{ lecture_form.DELETE }}
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% empty %}
                                <div style="text-align: center; padding: 2rem; border: 2px dashed #E2E8F0; border-radius: var(--border-radius);">
                                    <i class="fas fa-plus-circle" style="font-size: 1.5rem; color: var(--sidebar-accent); margin-bottom: 1rem;"></i>
                                    <p>Add your first section</p>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Pricing Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-tag"></i> Pricing
                    </h3>
                    
                    <div class="form-group">
                        {{ form.price.label_tag }}
                        <div class="price-input">
                            <span class="currency">$</span>
                            {{ form.price }}
                        </div>
                        {% if form.price.errors %}
                            <div class="error">{{ form.price.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        {{ form.discount_price.label_tag }}
                        <div class="price-input">
                            <span class="currency">$</span>
                            {{ form.discount_price }}
                        </div>
                        {% if form.discount_price.errors %}
                            <div class="error">{{ form.discount_price.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="checkbox-group">
                        {{ form.published }}
                        {{ form.published.label_tag }}
                        {% if form.published.errors %}
                            <div class="error">{{ form.published.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Additional Settings -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="fas fa-cog"></i> Additional Settings
                    </h3>
                    
                    <div class="form-group">
                        {{ form.language.label_tag }}
                        {{ form.language }}
                        {% if form.language.errors %}
                            <div class="error">{{ form.language.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        {{ form.difficulty.label_tag }}
                        {{ form.difficulty }}
                        {% if form.difficulty.errors %}
                            <div class="error">{{ form.difficulty.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Submit Section -->
                <div class="form-group" style="margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem;">
                        <i class="fas fa-rocket"></i> Publish Course
                    </button>
                </div>
            </div>
            
            <!-- Course Preview Card -->
            <div class="preview-card">
                <div class="preview-header">
                    <h3 class="preview-title">Course Preview</h3>
                    <p class="preview-subtitle">How your course will appear to students</p>
                </div>
                
                <div class="preview-body">
                    <div class="preview-thumbnail">
                        <img src="" alt="Course Thumbnail" id="preview-thumbnail-img">
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">
                            <i class="fas fa-image" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    
                    <div class="preview-meta">
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Title:</span>
                            <span class="preview-meta-value" id="preview-title">Untitled Course</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Instructor:</span>
                            <span class="preview-meta-value">Sarah Johnson</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Category:</span>
                            <span class="preview-meta-value" id="preview-category">Not selected</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Level:</span>
                            <span class="preview-meta-value" id="preview-level">Beginner</span>
                        </div>
                        <div class="preview-meta-item">
                            <span class="preview-meta-label">Price:</span>
                            <span class="preview-meta-value" id="preview-price">$0.00</span>
                        </div>
                    </div>
                    
                    <div class="preview-actions">
                        <button class="btn btn-secondary">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Draft
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block scripts %}
    <script>
        // JavaScript to handle thumbnail preview and other dynamic behaviors
        document.getElementById('id_thumbnail').addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const preview = document.getElementById('preview-thumbnail-img');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Update preview fields when form inputs change
        document.getElementById('id_title').addEventListener('input', function() {
            document.getElementById('preview-title').textContent = this.value || 'Untitled Course';
        });

        document.getElementById('id_category').addEventListener('change', function() {
            document.getElementById('preview-category').textContent = this.options[this.selectedIndex].text || 'Not selected';
        });

        document.getElementById('id_difficulty').addEventListener('change', function() {
            document.getElementById('preview-level').textContent = this.options[this.selectedIndex].text || 'Beginner';
        });

        document.getElementById('id_price').addEventListener('input', function() {
            document.getElementById('preview-price').textContent = '$' + (this.value || '0.00');
        });

        // Additional JavaScript for form validation, preview updates, etc.
    </script>
{% endblock %}